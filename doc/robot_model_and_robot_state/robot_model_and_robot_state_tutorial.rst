Robot Model and Robot State
===========================

.. image:: panda_tf.png
   :width: 700px
   :alt: "That is a sweet robot" you might say.

In this section, we will walk you through the C++ API for using kinematics in MoveIt.

The RobotModel and RobotState Classes
-------------------------------------
The :moveit_core:`RobotModel` and :moveit_core:`RobotState` classes are the core classes that give you access to a robot's kinematics.

The :moveit_core:`RobotModel` class contains the relationships between all links and joints including their joint limit properties as loaded from the URDF. The RobotModel also separates the robot's links and joints into planning groups defined in the SRDF. A separate tutorial on the URDF and SRDF can be found here: `URDF and SRDF Tutorial <../urdf_srdf/urdf_srdf_tutorial.html>`_

The :moveit_core:`RobotState` contains information about the robot at a certain point in time, storing vectors of joint positions and optionally velocities and accelerations. This information can be used to obtain kinematic information about the robot that depends on its current state, such as the Jacobian of an end effector.

RobotState also contains helper functions for setting the arm location based on the end effector location (Cartesian pose) and for computing Cartesian trajectories.

In this example, we will walk through the process of using these classes with the Panda.

Getting Started
---------------
If you haven't already done so, make sure you've completed the steps in `Getting Started <../getting_started/getting_started.html>`_.

Running the Code
----------------
All the code in this tutorial can be compiled and run from the
``moveit2_tutorials`` package that you have as part of your MoveIt
setup.

Roslaunch the launch file to run the code directly from moveit2_tutorials::

 ros2 launch moveit2_tutorials robot_model_and_robot_state_tutorial.launch.py

Expected Output
---------------
The expected output will be in the following form. The numbers will not match since we are using random joint values: ::

[INFO] [1631898031.574924606] [moveit_rdf_loader.rdf_loader]: Loaded robot model in 0.000592809 seconds
[INFO] [1631898031.574994726] [moveit_robot_model.robot_model]: Loading robot model 'panda'...
[WARN] [1631898031.580430720] [moveit_ros.robot_model_loader]: No kinematics plugins defined. Fill and load kinematics.yaml!
[INFO] [1631898031.580490364] [robot_model_and_state_tutorial]: Model frame: world
[INFO] [1631898031.580597709] [robot_model_and_state_tutorial]: Joint panda_joint1: 0.000000
[INFO] [1631898031.580618033] [robot_model_and_state_tutorial]: Joint panda_joint2: 0.000000
[INFO] [1631898031.580627042] [robot_model_and_state_tutorial]: Joint panda_joint3: 0.000000
[INFO] [1631898031.580636611] [robot_model_and_state_tutorial]: Joint panda_joint4: 0.000000
[INFO] [1631898031.580645550] [robot_model_and_state_tutorial]: Joint panda_joint5: 0.000000
[INFO] [1631898031.580654490] [robot_model_and_state_tutorial]: Joint panda_joint6: 0.000000
[INFO] [1631898031.580663569] [robot_model_and_state_tutorial]: Joint panda_joint7: 0.000000
[INFO] [1631898031.580680750] [robot_model_and_state_tutorial]: Current state is not valid
[INFO] [1631898031.580692623] [robot_model_and_state_tutorial]: Current state is valid
[INFO] [1631898031.580759950] [robot_model_and_state_tutorial]: Translation:
0.488887
 0.18437
0.532001

[INFO] [1631898031.580779924] [robot_model_and_state_tutorial]: Rotation:
  0.158002 -0.0172044   0.987289
  0.280844   0.959338 -0.0282278
 -0.946658   0.281734   0.156409

[ERROR] [1631898031.580792915] [moveit_robot_state.robot_state]: No kinematics solver instantiated for group 'panda_arm'
[INFO] [1631898031.580797175] [robot_model_and_state_tutorial]: Did not find IK solution
[INFO] [1631898031.580861568] [robot_model_and_state_tutorial]: Jacobian:
    -0.18437   -0.0630291     -0.25523     0.322092   0.00988796   -0.0811232 -5.42101e-20
    0.488887     0.188755     0.186954    -0.277097   -0.0111226     0.107916  2.77556e-17
           0   -0.0200336     0.453818     0.309284   -0.0644223   -0.0310831  5.20417e-18
           0    -0.948516     0.275299     0.501982     0.420656    -0.149548     0.987289
           0    -0.316728    -0.824447    -0.315378     0.902617     0.168221   -0.0282278
           1  4.89664e-12     0.494467    -0.805327   -0.0912728     0.974339     0.156409



**Note:** Don't worry if your output has different ROS console format.

The Entire Code
---------------
The entire code can be seen :codedir:`here in the MoveIt GitHub project<robot_model_and_robot_state/src/robot_model_and_robot_state_tutorial.cpp>`.

.. tutorial-formatter:: ./src/robot_model_and_robot_state_tutorial.cpp

The Launch File
^^^^^^^^^^^^^^^
To run the code, you will need a launch file that does two things:
 * Loads the Panda URDF and SRDF onto the parameter server, and
 * Puts the kinematics_solver configuration generated by the MoveIt Setup Assistant onto the ROS parameter server in the namespace of the node that instantiates the classes in this tutorial.

.. literalinclude:: ./launch/robot_model_and_robot_state_tutorial.py
